@using sistemproject.Models
@model List<sistemproject.Controllers.Node3Step>

<div class="col-12">
    @helper RenderNode(sistemproject.Controllers.Node3Step node, bool isFirst, bool isLast)
    {
    <div class="node" style="display: flow-root; width: 100%; ">
        <div class="float-end" style="width:100px;">
            <div data-rowid="@node.Id" class="NodeOrder nodeOrderStyle my-3">
                @if (!isFirst)
                {
                    <i class="upArrow sc-arrow-up-long" data-id="@node.ProjectId"></i>
                }
                @if (!isLast)
                {
                    <i class="downArrow sc-arrow-down-long" data-id="@node.ProjectId"></i>
                }
            </div>
            <div class="rowActions">
                <i class="sc-plus float-end m-1 fs-5 addNode py-3"></i>
                <i class="sc-minus float-end m-1 fs-5 removeNode py-3"></i>
            </div>
        </div>

        @*<div class="float-end d-flex align-items-center bg-light-gradient  min-w-550px px-1 py-1 mr-2">*@
        <div class="float-end d-flex align-items-center bg-light-gradient">
            <div class="min-w-100px pe-1">
                <div class="me-3">
                    <div class="d-flex align-items-center fw-bold text-white">**********</div>
                    <div class="d-flex align-items-center fw-bold fs-9">Adam/Gün Durum</div>
                    @*<div class="d-flex align-items-center fw-bold fs-9">*@
                    @if (node.Percent1 >= 100)
                    {
                        int percent1 = Convert.ToInt32(node.Percent1);
                        int percent2 = Convert.ToInt32(node.Percent2);
                        <div class="d-flex align-items-center fw-bold fs-9">










                            <div class="d-flex align-items-center w-100 mw-250px m-auto">
                                <div class="progress h-6px w-100 me-2 bg-light-success">
                                    <div class="progress-bar bg-success" role="progressbar" style="width:100%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="text-success fw-semibold">100%</span>
                            </div>
                        </div>
                        if (percent2 != 0)
                        {
                            <div class="d-flex align-items-center fw-bold fs-9">

                                <div class="d-flex align-items-center w-100 mw-250px m-auto">
                                    <div class="progress h-6px w-100 me-2 bg-light-danger">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width:@(node.LastNode == false ? percent1 : percent2 )%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span class="text-success fw-semibold">@(node.LastNode == false ? percent1 : percent2)%</span>
                                </div>
                            </div>
                        }

                    }
                    else if (node.Percent1 == 0)
                    { <div class="d-flex align-items-center fw-bold fs-9">

                            <div class="d-flex align-items-center w-100 mw-250px m-auto">
                                <div class="progress h-6px w-100 me-2 bg-light-success">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="text-gray-400 fw-semibold">0%</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        int percent1 = Convert.ToInt32(node.Percent1);
                        <div class="d-flex align-items-center fw-bold fs-9">

                            <div class="d-flex align-items-center w-100 mw-250px m-auto">
                                <div class="progress h-6px w-100 me-2 bg-light-success">
                                    <div class="progress-bar bg-success" role="progressbar" style="width:@percent1%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="text-success fw-semibold">@percent1%</span>
                            </div>
                        </div>
                    }
                    @*</div>*@
                </div>
            </div>
            <div class="min-w-100px pe-1">
                <div class="me-3">
                    <div class="d-flex align-items-center fw-bold text-white">**********</div>
                    <div class="d-flex align-items-center fw-bold fs-9">Hedeflenen</div>
                    <div class="d-flex align-items-center fw-bold fs-9">Güncel Gerçekleşen</div>
                </div>
            </div>
            @{
                var startDate = node.StartDate != null && node.StartDate.HasValue ? node.StartDate.Value.ToString("dd/MM/yyyy") : "-";
                var endDate = node.EndDate != null && node.EndDate.HasValue ? node.EndDate.Value.ToString("dd/MM/yyyy") : "-";
                var realizedStartDate = node.RealizedStartDate != null && node.RealizedStartDate.Value.ToString("yyyyMMdd") != "19000101" ? node.RealizedStartDate.Value.ToString("dd/MM/yyyy") : "-";
                var realizedEndDate = node.RealizedEndDate != null && node.RealizedEndDate.Value.ToString("yyyyMMdd") != "19000101" ? node.RealizedEndDate.Value.ToString("dd/MM/yyyy") : "-";
            }
            <div class="min-w-100px pe-1">
                <div class="me-3">
                    <div class="d-flex align-items-center fw-bold fs-9">Başlangıç Tarihi</div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark">@startDate</div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark">@realizedStartDate</div>
                </div>
            </div>
            <div class="min-w-100px pe-1">
                <div class="me-3">
                    <div class="d-flex align-items-center fw-bold fs-9">Bitiş Tarihi</div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark">@endDate</div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark">@realizedEndDate</div>
                </div>
            </div>
            <div class="min-w-100px pe-1">
                <div class="me-3">
                    <div class="d-flex align-items-center fw-bold fs-9">Adam/Gün</div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark"><font>@node.Day.ToString("0.##")</font></div>
                    <div class="d-flex align-items-center fw-bold fs-9 text-dark"><font>@node.RealizedDay.ToString("0.##")</font></div>
                </div>
            </div>
        </div>
        <i data-icon="" class="icon nodeStateDanger nodeState" @(node.LastNode == true && node.CurrentState == "Başlanacak" && node.Approval == 0 ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStateWarning nodeState" @(node.LastNode == true && node.CurrentState == "Devam Ediyor" && node.Approval == 2 ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStateSuccess nodeState" @(node.LastNode == true && node.CurrentState == "Tamamlandı" && node.Approval == 1 ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStatePrimary nodeState" @(node.LastNode == true && node.Approval == 3 ? "" : "hidden") style=""></i>
        @*<i data-icon="" class="icon nodeStateDanger nodeState" @(node.LastNode == true && node.CurrentState == "Başlanacak" ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStateWarning nodeState" @(node.LastNode == true && node.CurrentState == "Devam Ediyor" ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStateSuccess nodeState" @(node.LastNode == true && node.CurrentState == "Tamamlandı" ? "" : "hidden") style=""></i>
        <i data-icon="" class="icon nodeStatePrimary nodeState" @(node.LastNode == true && node.Approval == 3 ? "" : "hidden") style=""></i>*@
    <h6 class="toggle my-3 ml-5">
        <span class="@((node.Children != null && node.Children.Count > 0) ? "icontoogle" : "childPadding") tooglePlusButton"></span>
        <label data-ProjectId="@node.ProjectId" data-id="@node.Id" data-GroupNo="@node.GroupNo" data-Step="@node.Step" class="rowEditIcon">
            <a id="ShowStepDetailModal" href="#" data-ProjectId="@node.ProjectId" data-id="@node.Id" data-GroupNo="@node.GroupNo" data-Step="@node.Step"
               class="@((node.Children != null && node.Children.Count > 0) ? "HasChildNode" : "LastNode") fs-7">@node.GroupNo @node.Step</a>
        </label>
       
    </h6>
        <ul class="children" style="display:none">

            @for (int i = 0; i < node.Children.Count(); i++)
            {
                bool isFirstt = i == 0;
                bool isLastt = i == node.Children.Count() - 1;
                <li>@RenderNode(node.Children[i], isFirstt, isLastt)</li>
            }
        </ul>
    </div>
        }
        @if (Model != null && Model.Count > 0)
        {
            <ul class="treeview">
                @for (int i = 0; i < Model.Count; i++)
                {
                    bool isFirst = i == 0;
                    bool isLast = i == Model.Count - 1;
                    <li>@RenderNode(Model[i], isFirst, isLast)</li>
                }
            </ul>
        }
    </div>
<script>
    $(".tooglePlusButton").click(function () {
        $(this).toggleClass("collapsed");
        $(this).parent().siblings(".children").toggle();
    });
    $(".rowEditIcon").on('mouseenter', function () {
        window.GroupNo = $(this).data('groupno');
        window.Step = $(this).data('step');
        window.Id = $(this).data('id');
        window.projectid = $(this).data('projectid');
        $(this).append('<span class="" data-Step="' + window.Step + '"  data-GroupNo="' + window.GroupNo + '" data-id="' + window.Id + '"  data-projectid="' + window.projectid + '" id="EditStep"><i class="sc-edit-pencil float-center fs-5"></i></span>');
    }).on('mouseleave', function () {
        $(this).find("#EditStep").remove();
    });

</script>