@model  (List<sistemproject.Models.CustomerPanelViewModels.CompanyInfoViewModel>, List<dynamic>, List<sistemproject.Models.CustomerPanelViewModels.CompanyContractModel>, List<dynamic>)
@{
    ViewBag.Title = "MyCompanyInfo";
    Layout = "~/Views/Shared/NewThema/_LayoutTakvim.cshtml";
}

<link href="~/Content/FullCalendar/main_core.css" rel="stylesheet" />
<style>
    .card {
        border: none !important;
    }

    .breadcrumb {
        background-color: transparent !important;
        font-weight: 600;
    }

    .displaycpm {
        display: flex;
    }

        .displaycpm p {
            /*  font-family: 'MS Gothic';*/
            /*font-family: Roboto;*/
            font-size: 14px;
            line-height: 18px;
            font-weight: 400;
            color: #406C80;
            margin: auto 0px !important;
        }

        .displaycpm .companyname {
            /*  font-family: 'MS Gothic';*/
            /*  font-family: Roboto;*/
            font-size: 16px;
            line-height: 20px;
            font-weight: 700;
            color: #406C80;
            margin: auto 0px !important;
        }

    .icn {
        padding: 0px !important;
        width: 36px;
        height: 36px;
        margin-right: 16px;
    }

    .icn2 {
        padding: 0px !important;
        width: 36px;
        height: 36px;
        margin-right: 16px;
    }

    .icn3 {
        padding: 0px !important;
        width: 20px;
        height: 20px;
        margin-right: 16px;
    }

    .companyicn {
        padding: 0px !important;
        width: 48px;
        height: 48px;
        margin-right: 16px;
    }

    .contact-icon {
        margin: auto 4px;
        padding: 4px;
    }

    .fontTitle {
        color: #406C80;
        font-weight: bold;
        font-size: 0.9rem;
    }

    .label-text {
        color: #406C80 !important;
        font-size: 0.9rem !important;
    }

    .pageRouteButton {
        background-color: #406C8033;
        padding: 0.3rem;
        margin-right: 1rem;
        border-radius: 4px;
    }

    .lineHeight {
        line-height: 2rem;
    }

    .licenseinfo {
        margin: 6px;
        padding: 10px;
    }
    /******************************************/
    .file-box-content {
        margin-bottom: -16px;
    }

        .file-box-content .file-box {
            border: 1px solid #eff2f9;
            border-radius: 5px;
            padding: 20px;
            width: 160px;
            display: inline-block;
            margin-right: 5px;
            margin-bottom: 16px;
            background-color: #ffffff;
        }

            .file-box-content .file-box .download-icon-link {
                color: #a4abc5;
            }

                .file-box-content .file-box .download-icon-link .file-download-icon {
                    font-size: 13px;
                    position: relative;
                    top: -10px;
                    left: 110px;
                }

                .file-box-content .file-box .download-icon-link:hover {
                    color: #4d79f6;
                }

            .file-box-content .file-box i {
                font-size: 34px;
            }
    /*****************************************/
    .bs-tooltip-auto[x-placement^=top] .arrow::before, .bs-tooltip-top .arrow::before {
        border-top-color: #20A1DA !important;
    }
</style>
<div class="d-flex flex-column flex-root">
    <div class="page d-flex flex-row flex-column-fluid">
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                <div class="post d-flex flex-column-fluid" id="kt_post">
                    <div id="kt_content_container" class="container-xxl mt-5">
                        <div class="row m-3">
                            <div class="col-lg-12 col-md-12">
                                <nav style="--bs-breadcrumb-divider: '>'!important;" aria-label="breadcrumb">
                                    <ol class="breadcrumb my-auto">
                                        <li><i class="sc-arrow-left-long pageRouteButton"></i></li>
                                        <li class="breadcrumb-item"><a class="color-link-passive" href="/CpmServisSistemi/Anasayfa">Anasayfa</a></li>
                                        <li class="breadcrumb-item color-link-active" aria-current="page">Firma Bilgilerim</li>
                                    </ol>
                                </nav>
                            </div>
                        </div>
                        <div class="card mr-5 ml-5">
                            @if (Model.Item1.Count != 0)
                            {
                                <div class="row d-flex justify-content-between align-items-center" style="width: inherit; margin-right: 15px; margin-left: 15px;">
                                    <div class="col-lg-6 col-md-6 col-sm-12 d-flex justify-content-start align-items-center" style="padding-left: 15px;">
                                        <div class="displaycpm my-3">
                                            <img class="companyicn" src="~/Images/requestImg/company.png">
                                            <p class="companyname" data-id="@Model.Item1.First().CompanyName">
                                                @(Model.Item1.First().CompanyName == null || Model.Item1.First().CompanyName == ""  ? "Bilinmiyor !" : Model.Item1.First().CompanyName)
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 col-sm-12 d-flex justify-content-end align-items-center">
                                        @if (Session["Role"].ToString() == "1")
                                        {
                                            <button type="button" id="entryInformation" class="fc-myCustomButtonNewPlan-button fc-button fc-button-primary" style="margin-right: 15px;">Bilgi Girişi</button>
                                        }




                                        <button type="button" id="showInformationMail" style="margin-left: 0; width:fit-content; height:fit-content; padding: 5px 15px !important;" class="Button-Outline-Kaydet">
                                            <i class="icon sc-mail mr-3 pt-3" style="color:var(--thWhite);">&nbsp;&nbsp;Mail Gönder</i>
                                        </button>

                                        <button type="button" id="showInformationSms" style="margin-left: 3px; width:fit-content; height:fit-content; padding: 5px 15px !important;" class="Button-Outline-Kaydet">
                                            <i class="icon sc-device-phone mr-3 pt-3" style="color:var(--thWhite);">&nbsp;&nbsp;Sms Gönder</i>
                                        </button>
                                    </div>
                                </div>
                            }
                            <div class="card-body mt-3 mb-3" id="cardBody" style="padding:0 !important;">
                                <div class="row px-5 m-3">
                                    @if (Model.Item1.Count != 0)
                                    {
                                        <div class="col-lg-6 mb-5">
                                            <div class="displaycpm my-3">
                                                <h5 style="color:#D97D21;font-weight:bold;">İletişim Bilgileri</h5>
                                            </div>
                                            <div class="displaycpm my-3">
                                                <img class="icn" src="~/Images/requestImg/phone.png" />
                                                <p class="label-text">@(Model.Item1.First().Telephone == null || Model.Item1.First().Telephone == "" ? "Bilinmiyor !" : Model.Item1.First().Telephone)</p><br />
                                            </div>
                                            <div class="displaycpm my-3">
                                                <img class="icn" src="~/Images/requestImg/location.png" />
                                                <p style="display:inline;" class="label-text">
                                                    @(Model.Item1.First().Adress == null || Model.Item1.First().Telephone == "" ? "Bilinmiyor !" : Model.Item1.First().Adress)
                                                    @(Model.Item1.First().ProvinceName == null || Model.Item1.First().Telephone == "" ? "" : Model.Item1.First().ProvinceName)
                                                    @(Model.Item1.First().DistrictName == null || Model.Item1.First().Telephone == "" ? "" : Model.Item1.First().DistrictName)

                                                </p>
                                            </div>
                                            <label class="label-text">@(Model.Item1.First().SASIFRE == null || Model.Item1.First().SASIFRE == "" ? "Bilinmiyor !" : Model.Item1.First().SASIFRE)</label>
                                        </div>
                                    }
                                    <div class="col-lg-6 mb-5">
                                        <div class="displaycpm my-3">
                                            <h5 style="color:#D97D21;font-weight:bold;">Firma Yetkilileri</h5>
                                        </div>

                                        <div style="max-height: 300px; overflow-y: auto;">
                                            @if (Model.Item1.Count == 0)
                                            {
                                                <div class="my-3">
                                                    <div class="displaycpm my-3" style=" margin: inherit;">
                                                        <img class="icn2" src="/Images/requestImg/icons8-medium_risk.png" height="20px">
                                                        <p>
                                                            Herhangi bir <font style="text-decoration: underline;font-weight:bold;">yetkili</font> bulunmamaktadır !
                                                        </p>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                foreach (var x in Model.Item1)
                                                {
                                                    <div class="displaycpm my-3" style=" margin: inherit;">
                                                        <img class="icn2" src="~/Images/requestImg/user.png" style="" height="50px" />
                                                        <p>
                                                            <font class="fontTitle" style="font-weight:bold;">@(x.FullName == null || x.FullName == ""  ? "Bilinmiyor !" : x.FullName)</font><br />
                                                            <span style="font-size:12px;">@(x.Email == null || x.Email == ""  ? "Bilinmiyor !" : x.Email)</span> / <span style="font-size:12px;">@(x.Telephone == null || x.Telephone == ""  ? "Bilinmiyor !" : x.Telephone)</span><br />
                                                            <font class="label-text">@(x.Departman == null || x.Departman == ""  ? "Bilinmiyor !" : x.Departman)</font>
                                                            <div style="margin:auto;"></div>
                                                            <a class="contact-icon" data-toggle="tooltip" data-placement="top" title="@x.Telephone" href="tel:@x.Telephone"><i class="sc-device-phone"></i></a>
                                                            <a class="contact-icon" data-toggle="tooltip" data-placement="top" title="@x.Email" href="mailto:@x.Email"><i class="sc-mail"></i></a>
                                                    </div>
                                                }
                                            }
                                        </div>
                                    </div>
                                    <hr style="border-top: 1px solid #406C801A !important; margin-left:0px !important; margin-right: 0px !important;" />
                                    <div class="col-lg-6">
                                        <div class="displaycpm my-3">
                                            <h5 style="color:#D97D21;font-weight:bold;">Lisanslar</h5>
                                        </div>
                                        <div class="my-3" style="max-height: 300px; overflow-y: auto;">
                                            @if (Model.Item2.Count() == 0)
                                            {
                                                <div class="displaycpm my-3" style=" margin: inherit;">
                                                    <img class="icn2" src="~/Images/requestImg/icons8-medium_risk.png" height="20px" />
                                                    <p>
                                                        Herhangi bir <font style="text-decoration: underline;font-weight:bold;">lisansınız</font> bulunmamaktadır !
                                                    </p>
                                                </div>
                                            }
                                            else
                                            {
                                                foreach (IGrouping<dynamic, dynamic> unvans in Model.Item2.GroupBy(elm => elm.UNVAN).ToList())
                                                {
                                                    <div class="my-3"><font class="fontTitle" style="font-size:14px;">@unvans.Key</font></div>
                                                    <div class="row px-3">
                                                        @foreach (object x in unvans)
                                                        {
                                                            Html.RenderPartial("~/Views/Shared/DetailCards/_LicenseInfo.cshtml", x);
                                                        }
                                                    </div>
                                                }
                                            }
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="displaycpm my-3">
                                            <h5 style="color:#D97D21;font-weight:bold;">Sözleşme Bilgileri</h5>
                                        </div>
                                        <div class="my-3" style="max-height: 300px; overflow-y: auto;">
                                            @if (Model.Item3.Count == 0)
                                            {
                                                <div class="my-3">
                                                    <div class="displaycpm my-3" style=" margin: inherit;">
                                                        <img class="icn2" src="/Images/requestImg/icons8-medium_risk.png" height="20px">
                                                        <p>
                                                            Herhangi bir <font style="text-decoration: underline;font-weight:bold;">sözleşme</font> bulunmamaktadır !
                                                        </p>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                foreach (sistemproject.Models.CustomerPanelViewModels.CompanyContractModel item in Model.Item3)
                                                {
                                                    Html.RenderPartial("~/Views/Shared/DetailCards/_ContractInfo.cshtml", item);
                                                }
                                            }
                                        </div>
                                    </div>
                                    @if (Model.Item4.Any())
                                    {
                                        <div class="col-12">
                                            <h5 style="margin: 1rem !important;color:#D97D21;font-weight:bold;">Dosyalar</h5>
                                            <hr style="border-top: 1px solid #406C801A !important; margin-left:0px !important; margin-right: 0px !important;" />

                                            @foreach (var item in Model.Item4)
                                            {
                                                <div class="file-box-content mb-2">
                                                    <div class="file-box">
                                                        <a href="@Url.Action("CompanyDownloadFile", "CpmServisSistemi", new { ID = item.ID })" class="download-icon-link">
                                                            <i class="sc-download file-download-icon"></i>
                                                        </a>
                                                        <div class="text-center">
                                                            @{string type = MimeMapping.GetMimeMapping(item.DOSYAAD);}
                                                            @if (type == "application/pdf")
                                                            {
                                                                <i class="sc-file-pdf text-primary"></i>
                                                            }
                                                            else if (type == "application/x-zip-compressed")
                                                            {
                                                                <i class="sc-file-zip text-primary"></i>
                                                            }
                                                            else if (type == "image/png")
                                                            {
                                                                <i class="sc-file-png text-primary"></i>
                                                            }
                                                            else if (type == "image/jpeg")
                                                            {
                                                                <i class="sc-file-jpg text-primary"></i>
                                                            }
                                                            else if (type == "application/vnd.ms-excel" || type == "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")
                                                            {
                                                                <i class="sc-file-excel text-primary"></i>
                                                            }
                                                            else if (type == "application/msword" || type == "application/vnd.openxmlformats-officedocument.wordprocessingml.document")
                                                            {
                                                                <i class="sc-file-word text-primary"></i>
                                                            }
                                                            else
                                                            {
                                                                <i class="sc-file-code text-primary"></i>
                                                            }
                                                            <h6 class="text-truncate">@item.DOSYAAD</h6>
                                                            <small class="text-muted">@item.DOSYATIP/@item.DOSYAUZUNLUK (BYTE)</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal HTML -->


<script>
    function getCompanyConnectionInfo(companyId, isSms) {
        debugger;
        $.ajax({
            method: "GET",
            url: "/CpmServisSistemi/GetCompanyConInfoScreen?companyId=" + companyId + "&isSms=" + isSms,
            success: function (data) {
                if (data.IsSuccess) {
                    swal("Bağlantı Bilgileri tarafınıza gönderildi. Bağlantının geçerlilik süresi 5 dakikadır!", {
                        title: "UYARI !",
                        icon: "info",
                        buttons: "Tamam",
                    });
                } else {
                    swal(data.Message, {
                        title: "UYARI !",
                        icon: "info",
                        buttons: "Tamam",
                    });
                }
                setTimeout($.unblockUI, 240);
            },
            error: function () {
                swal("Erişim sağlanamadı.", {
                    title: "UYARI !",
                    icon: "info",
                    buttons: "Tamam",
                });
                setTimeout($.unblockUI, 240);
            }
        });
    }
    $(document).ready(function () {


        function getCompanyId() {
            var queryString = window.location.search;
            var urlParams = new URLSearchParams(queryString);
            return urlParams.get('CompanyId');

        }

        var companyId = getCompanyId(); // Fonksiyon çağrıldıktan sonra değişkene atanmalı

        $('#showInformationSms').click(function () {
            debugger;

            if (!companyId) {
                console.error("CompanyId bulunamadı.");
                return;
            }

            $.ajax({
                method: "GET",
                url: "/CpmServisSistemi/CompanyConnectiondata?AccountNo=" + companyId,
                success: function (data) {
                    if (data.connectionInfos && data.connectionInfos.length > 0) {
                        data.connectionInfos.forEach(function (info) {
                            if (info.RdPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet",
                                    cancelButtonText: "Hayır"
                                }).then((result) => {
                                    if (result==true) {
                                        getCompanyConnectionInfo(companyId,true);
                                    }
                                });
                            }
                            else if (info.SqlPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet"
                                }).then((result) => {
                                    if (result == true) {
                                        getCompanyConnectionInfo(companyId,true);
                                    }
                                });
                            }
                            else if (info.VpnPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet"
                                }).then((result) => {
                                    if (result == true) {
                                        getCompanyConnectionInfo(companyId,true);
                                    }
                                });
                            }
                            else {
                                getCompanyConnectionInfo(companyId,true)
                            }
                        });
                    } else {
                        console.error("Bağlantı bilgisi bulunamadı.");
                    }
                },
                error: function () {
                    console.error("AJAX isteği başarısız oldu.");
                }
            });



        });

        $('#showInformationMail').click(function () {
            debugger;
            if (!companyId) {
                console.error("CompanyId bulunamadı.");
                return;
            }

            $.ajax({
                method: "GET",
                url: "/CpmServisSistemi/CompanyConnectiondata?AccountNo=" + companyId,
                success: function (data) {
                    if (data.connectionInfos && data.connectionInfos.length > 0) {
                        data.connectionInfos.forEach(function (info) {
                            if (info.RdPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet",
                                    cancelButtonText: "Hayır"
                                }).then((result) => {
                                    if (result == true) {
                                        getCompanyConnectionInfo(companyId,false);
                                    }
                                });
                            }
                            else if (info.SqlPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet"
                                }).then((result) => {
                                    if (result == true) {
                                        getCompanyConnectionInfo(companyId,false);
                                    }
                                });
                            }
                            else if (info.VpnPassword == null) {
                                swal({
                                    title: "Rdp Şifresi kayıtlı değil!",
                                    text: "Yine de göndermek istiyor musunuz?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Evet"
                                }).then((result) => {
                                    if (result == true) {
                                        getCompanyConnectionInfo(companyId,false);
                                    }
                                });
                            }
                            else {
                                getCompanyConnectionInfo(companyId,false)
                            }
                        });
                    } else {
                        console.error("Bağlantı bilgisi bulunamadı.");
                    }
                },
                error: function () {
                    console.error("AJAX isteği başarısız oldu.");
                }
            });
        });
        $('#entryInformation').click(function () {
            var companyId = getCompanyId();
            var CompanyName = $('.companyname').data('id');
            debugger;
            window.location.href = "/CpmServisSistemi/CompanyConnectionEntry?AccountNo=" + companyId + "&CompanyName=" + CompanyName;

        });
        $(document).on("click", "#passwordshow", function () {
            input = $(this).parent().find("input");


            if (input.attr("type") == "password") {
                input.attr("type", "text");
            } else {
                input.attr("type", "password");

            }
        });
        $(document).on("change", "#vpnProgram", function () {
            const connectionType = $(this).val();
            if (connectionType != "other") {
                $(".divVpnProgramName").attr("hidden", true);
            } else {
                $(".divVpnProgramName").removeAttr("hidden");
            }
        });
        $(document).on("change", "#connectionType", function () {
            const connectionType = $(this).val();
            if (connectionType != "vpn") {
                $(".vpnDiv").attr("hidden", true);
            } else {
                $(".vpnDiv").removeAttr("hidden");
            }
        });
        $(document).on("click", ".pageRouteButton", function () {
            window.history.back()
        });
    });



</script>

