@using sistemproject.Models
@model  (List<ProjectManagerStep> waitingApprovalList, List<ProjectManagerStep> completedApprovalList)
@{
    ViewBag.Title = "AdminApproval";
    Layout = "~/Views/Shared/NewThema/_LayoutTakvim.cshtml";
}
<link href="~/Content/SweetAlert2/sweetalert2.min.css" rel="stylesheet" />
<style>
    #staticBackdrop2 {
        z-index: 1050; /* Önde olan modal için yüksek bir z-index değeri belirleyin */
    }

    .swal-popup {
        z-index: 1081 !important; /* Yüksek z-index değeri */
    }

    .swal2-container {
        z-index: 1060 !important;
    }

    #ServiceFormModal {
        z-index: 1060; /* Arkada olan modal için daha düşük bir z-index değeri belirleyin */
    }

    .cardServiceForm:hover {
        background-color: #bdd6eb !important;
        cursor: pointer;
    }

    .form-control:disabled, .form-control:read-only {
        background-color: #406C800D;
    }

    .table thead th {
        border-bottom: 1px solid #406C8033 !important;
        background-color: #406C800D;
    }

    .threeDot {
        white-space: nowrap;
        display: inline-block;
        overflow: hidden;
        table-layout: fixed;
        width: 180px;
        text-overflow: ellipsis;
    }

    .rounded-circle {
        box-shadow: none !important;
    }

    .card {
        box-shadow: 0px 0px 20px rgb(31 36 54 / 10%) !important;
    }

    .card-header {
        /*        background-color: #17996E1A !important;*/
        border-top-right-radius: 6px !important;
        border-top-left-radius: 6px !important;
    }

    .custom-select, .form-control-sm {
        border-radius: 6px !important;
    }
    .sc-closeFilter:hover {
        background-color: #eff2f9;
        border-radius: 50%;
        padding: 0.5rem;
        cursor: pointer;
    }

    .sc-closeFilter {
        background-color: #fff;
        border-radius: 50%;
        padding: 0.5rem;
    }
</style>
<link href="~/Content/DatatableCss/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/ProjectCss/style.css" rel="stylesheet" />

<div class="d-flex flex-column flex-root" id="deneme">
    <div class="page d-flex flex-row flex-column-fluid">
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                <div class="post d-flex flex-column-fluid" id="kt_post">
                    <div id="kt_content_container" class="container-xxl">
                        <div class="container-fluid">
                            <div class="row mt-5">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header my-auto">
                                            <h3 class="my-auto">Onay Bekleyen Adımlar</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive dash-social">
                                                <table id="datatable" class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Adım</th>
                                                            <th>Müşteri Proje Sorumlusu</th>
                                                            <th>Cpm Proje Sorumlusu</th>
                                                            <th>Danışman</th>
                                                            <th>Adam/Gün</th>
                                                            <th>Onayla/Reddet</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.waitingApprovalList)
                                                        {
                                                            <tr>
                                                                <td class="">
                                                                    <p class="d-inline-block align-middle mb-0">
                                                                        <span class="d-inline-block align-middle mb-0 product-name threeDot" title="@item.GroupNo &nbsp;@item.Step"><font style="font-weight:bold;">@item.GroupNo &nbsp;@item.Step</font></span>
                                                                        <br>
                                                                        <span class="text-muted font-13 threeDot" title="">@item.StartDate.Value.ToString("dd/MM/yyyy")-@item.EndDate.Value.ToString("dd/MM/yyyy")</span>
                                                                    </p>
                                                                </td>
                                                                <td>@item.CurrentCompanyResponsible</td>
                                                                <td>@item.CurrentCpmResponsible</td>
                                                                <td>
                                                                    <span class="">@item.CurrentEmployee</span>
                                                                </td>
                                                                <td>
                                                                    <span class="badge badge-soft-purple fs-6 p-2">@item.Day.Value.ToString("F", System.Globalization.CultureInfo.InvariantCulture).Replace(".00", "")</span>
                                                                </td>
                                                                <td>
                                                                    <i id="ShowStepDetailModal" data-id="@item.Id" class="mr-4 btn btn-sm btn-soft-primary">
                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                                                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                                                                        </svg>
                                                                    </i>
                                                                </td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-5">
                                <div class="col-12">
                                    <div class="">
                                        <button type="button" class="btn btn-light-primary m-2 float-center" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" id="FilterForDatatable">
                                            <!--begin::Svg Icon | path: icons/duotune/general/gen031.svg-->
                                            <span class="svg-icon svg-icon-2">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M19.0759 3H4.72777C3.95892 3 3.47768 3.83148 3.86067 4.49814L8.56967 12.6949C9.17923 13.7559 9.5 14.9582 9.5 16.1819V19.5072C9.5 20.2189 10.2223 20.7028 10.8805 20.432L13.8805 19.1977C14.2553 19.0435 14.5 18.6783 14.5 18.273V13.8372C14.5 12.8089 14.8171 11.8056 15.408 10.964L19.8943 4.57465C20.3596 3.912 19.8856 3 19.0759 3Z" fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            <!--end::Svg Icon-->Filtreleme Seçenekleri
                                        </button>
                                        <!--begin::Content-->

                                        <div class="px-5 py-5" data-kt-user-table-filter="form" style=" position: absolute; top: 48px; left: 24px; width: 292px; padding: 10px; background-color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.2); display: none; z-index: 3000;">
                                            <div class="col-12 text-end">
                                                <i class="sc-close sc-closeFilter"></i>
                                                @*<span>Kapat</span>*@
                                            </div>
                                            <!--begin::Input group-->
                                            <div class="mb-10">
                                                <label class="form-label fs-6 fw-semibold">Proje Adı:</label>
                                                <select class="selectpicker font13 selectValidateControl p-0" id="ProjectName" data-live-search="true" data-live-search-style="contains" data-show-subtext="true" name="ProjectName" required data-column="0">
                                                    <option data-tokens="" value="">Seçiniz</option>
                                                    @foreach (var group in Model.completedApprovalList.GroupBy(x => x.ProjectId))
                                                    {
                                                        foreach (var t in group)
                                                        {
                                                            <option data-tokens="" data-id="@t.ProjectId" value="@t.ProjectName">@t.ProjectName</option>
                                                            break; // Sadece bir kez option etiketi oluşturmak için grup içindeki ilk öğeyi seçtikten sonra döngüyü sonlandırıyoruz.
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <!--end::Input group-->
                                            <!--begin::Input group-->
                                            <div class="mb-10">
                                                <label class="form-label fs-6 fw-semibold">Onaylayan:</label>
                                                <select class="selectpicker font13 selectValidateControl p-0" id="ApprovalBy" data-live-search="true" data-live-search-style="contains" data-show-subtext="true" name="ApprovalBy" required data-column="8">
                                                    <option data-tokens="" value="">Seçiniz</option>
                                                    @foreach (var group in Model.completedApprovalList.GroupBy(x => x.ApprovalBy))
                                                    {
                                                        foreach (var t in group)
                                                        {
                                                            <option data-tokens="" data-id="@t.ApprovalBy" value="@t.ApprovalFullName">@t.ApprovalFullName</option>
                                                            break; // Sadece bir kez option etiketi oluşturmak için grup içindeki ilk öğeyi seçtikten sonra döngüyü sonlandırıyoruz.
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <!--end::Input group-->
                                            <!--begin::Input group-->
                                            <div class="mb-10">
                                                <label class="form-label fs-6 fw-semibold">Onay Durum:</label>
                                                <select class="selectpicker font13 selectValidateControl p-0" id="Approval" data-live-search="true" data-live-search-style="contains" data-show-subtext="true" name="Approval" required data-column="2">
                                                    <option data-tokens="" value="">Seçiniz</option>
                                                    @foreach (var group in Model.completedApprovalList.GroupBy(x => x.Approval))
                                                    {
                                                        foreach (var t in group)
                                                        {
                                                            <option data-tokens="" data-id="@t.Approval" value="@(t.Approval==1 ? "Onaylandı": "Reddedildi")">@(t.Approval == 1 ? "Onaylandı":"Reddedildi")</option>
                                                            break; // Sadece bir kez option etiketi oluşturmak için grup içindeki ilk öğeyi seçtikten sonra döngüyü sonlandırıyoruz.
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="mb-10">
                                                <label class="form-label fs-6 fw-semibold">Onaya Gönderen:</label>
                                                <select class="selectpicker font13 selectValidateControl p-0" id="ApprovalRequestBy" data-live-search="true" data-live-search-style="contains" data-show-subtext="true" name="ApprovalRequestBy" required data-column="2">
                                                    <option value="">Seçiniz</option>
                                                    @foreach (var group in Model.completedApprovalList.GroupBy(x => x.ApprovalRequestBy))
                                                    {
                                                        foreach (var t in group)
                                                        {
                                                            <option data-tokens="" data-id="@t.ApprovalRequestBy" value="@t.ApprovalRequestFullName">@t.ApprovalRequestFullName</option>
                                                            break; // Sadece bir kez option etiketi oluşturmak için grup içindeki ilk öğeyi seçtikten sonra döngüyü sonlandırıyoruz.
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <!--begin::Actions-->
                                            <div class="d-flex justify-content-end">
                                                <button id="FilterButton" type="button" class="btn btn-primary mr-3" data-kt-user-table-filter="filter">Filtrele</button>
                                                <button type="button" class="btn btn-secondary" data-kt-user-table-filter="reset" id="ResetTable">Sıfırla</button>
                                            </div>
                                            <!--end::Actions-->
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header my-auto">
                                            <h3 class="my-auto">Onaylanan & Reddedilen Adımlar</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive dash-social">
                                                <table id="datatable2" class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Proje Adı</th>
                                                            <th>Proje Adım</th>
                                                            <th>Onaya Gönderen</th>
                                                            <th>Gönderim Tarihi</th>
                                                            <th>Onay Durum</th>
                                                            <th>Onaylayan</th>
                                                            <th>Onaylama Zamanı</th>
                                                            <th>Yanıt</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var m in Model.completedApprovalList)
                                                        {
                                                            <tr>
                                                                <td class="fs-8 font-weight-bold">@m.ProjectName</td>
                                                                <td class="fs-8 font-weight-bold">@m.Step</td>
                                                                <td class="fs-8 font-weight-bold">@m.ApprovalRequestFullName</td>
                                                                <td class="fs-8 font-weight-bold">@((m.ApprovalRequestAt.HasValue) ? m.ApprovalRequestAt.Value.ToString("dd.MM.yyyy") : "")</td>
                                                                <td class="fs-8 font-weight-bold">@(m.Approval==1 ? "Onaylandı": "Reddedildi")</td>
                                                                <td class="fs-8 font-weight-bold">@m.ApprovalFullName</td>
                                                                <td class="fs-8 font-weight-bold">@((m.ApprovalAt.HasValue) ? m.ApprovalAt.Value.ToString("dd.MM.yyyy") : "")</td>
                                                                <td class="fs-8 font-weight-bold">@m.ReasonForRejection</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade " id="ServiceFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="ServiceFormModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="min-width: 924px;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="row  ml-1  " style="background-color:#fff;">
                    <div class="col-lg-2 col-md-6 col-sm-12 text-leftmy-auto pl-4">
                        <img src="/Images/images/cpm/Agenda.png" height="80">
                    </div>
                    <div class="col-lg-10 col-md-12 col-sm-12 my-auto pl-4">
                        <span class="" style="color: var(--thTitle);font-weight:bold;">Proje Formu Oluştur</span> <br>
                        <span class="font11" style="color: var(--thNewText);">Proje bazlı form oluşturmak için lütfen aşağıdaki alanları giriniz.</span>
                    </div>
                </div>
                @*<h5 class="modal-title" id="ServiceFormModalLabel">Proje Adımı Yönetimi</h5>*@
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazgeç</button>
                <button type="button" class="btn btn-primary" data-projectId="" data-stepId="" data-groupNo="" id="SubmitForm">Kaydet</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade " id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" style=" max-width: 869px!important;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Proje Adımı Yönetimi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <i id="AdminApproved" data-id="" class="mr-4 btn btn-sm btn-soft-success" title="Onayla">
                    Onayla
                    <svg style="margin: 2px;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-check" viewBox="0 0 16 16">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855a.75.75 0 0 0-.124 1.329l4.995 3.178 1.531 2.406a.5.5 0 0 0 .844-.536L6.637 10.07l7.494-7.494-1.895 4.738a.5.5 0 1 0 .928.372l2.8-7Zm-2.54 1.183L5.93 9.363 1.591 6.602l11.833-4.733Z" />
                        <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-1.993-1.679a.5.5 0 0 0-.686.172l-1.17 1.95-.547-.547a.5.5 0 0 0-.708.708l.774.773a.75.75 0 0 0 1.174-.144l1.335-2.226a.5.5 0 0 0-.172-.686Z" />
                    </svg>
                </i>
                <i id="AdminRefused" data-id="" class="btn btn-sm btn-soft-danger" title="Reddet">
                    Reddet
                    <svg style="margin: 2px;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-dash" viewBox="0 0 16 16">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855a.75.75 0 0 0-.124 1.329l4.995 3.178 1.531 2.406a.5.5 0 0 0 .844-.536L6.637 10.07l7.494-7.494-1.895 4.738a.5.5 0 1 0 .928.372l2.8-7Zm-2.54 1.183L5.93 9.363 1.591 6.602l11.833-4.733Z" />
                        <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-5.5 0a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5Z" />
                    </svg>
                </i>
                <!--<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazgeç</button>-->
                @*<button type="button" class="btn btn-primary" data-projectId="" data-stepId="" data-groupNo="" id="UpdateStepDetail">Kaydet</button>*@
                <!--<button type="button" class="btn btn-primary" id="ChangeState">Tamamlanma Onayına Gönder</button>-->
                @*<a  href="@Url.Action("CreateForm", "Project", new { ProjectId = Model.Item2.FirstOrDefault().Id})" class="mr-2 btn btn-success" id="CreateServiceForm">Servis Formu Oluştur</a>*@
                <!--<button type="button" class="mr-2 btn btn-success" id="CreateServiceForm">Proje Formu Oluştur</button>-->
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/SweetAlert2/sweetalert2.all.min.js"></script>
<script src="~/Scripts/DatatableScripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.bootstrap4.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.responsive.min.js"></script>

<script type="text/javascript">
    var quill = null;
    function initEditor() {
        quill = new Quill('#editor', {
            theme: 'snow'
        });
    }
    // Modal açıldığında editör yüklenir
    $('#ServiceFormModal').on('shown.bs.modal', function (e) {
        initEditor();
    });
    // Modal kapandığında editör yok edilir
    $('#ServiceFormModal').on('hidden.bs.modal', function (e) {
        quill = null;
    });
    function getEditorData() {
        var html = quill.root.innerHTML;
        var text = quill.getText();
        var contents = quill.getContents();
        console.log('Girilen Metin:', text);
        console.log('Metin İçeriği:', contents);
        console.log('html İçeriği:', html);
    }

    // #region Gunun Tarihini ve Saatini Getirme
    try {
        /*Günün tarihini alma ve formatlama) */
        Date.prototype.getValidFormat = function () {
            var ay = this.getMonth() + 1;
            var gun = this.getDate();
            var yil = this.getFullYear();
            return yil + "-" + (ay < 10 ? "0" + ay : ay) + "-" + (gun < 10 ? "0" + gun : gun); //Gün ve ay 10 dan küçükse başına 0 gelir
        };
        var date = new Date();
        $(".getDate").val(date.getValidFormat());
    } catch (error) {
        console.error(error);
    }
    // #endregion
    //#region Dosyaları Diziye atma
    window.filesArray = [];
    $("#multipleFile").on("change", function (e) {
        var files = e.target.files;
        for (var i = 0; i < files.length; i++) {
            window.filesArray.push(files[i]);
        }
    });
    //#endregion
    $(document).ready(function () {
        var StepDetailModal2 = new bootstrap.Modal(document.getElementById('staticBackdrop2'), {
            backdrop: 'static',
            keyboard: false
        });
        var ServiceFormModal = new bootstrap.Modal(document.getElementById('ServiceFormModal'), {
            backdrop: 'static',
            keyboard: false
        });
        $('body').on('click', '#ShowStepDetailModal', function () {
            window.table = $('#datatable').DataTable();
            window.removingRow = $(this).closest('tr');
            var Id = $(this).attr("data-id");
            $.ajax({
                url: '/Project/CheckStepDetail',
                type: 'POST',
                data: { Id: Id },
                success: function (result) {
                    if (result.IsSuccess) {
                        $('#staticBackdrop').find('.modal-footer #SubmitStepDetail').attr('data-id', Id);
                        $('#staticBackdrop').find('.modal-body #step-value').text(GroupNo + " " + Step);
                        StepDetailModal.show();
                    }
                    else {
                        $.get('GetDetail', { Id: Id, IsReadOnly: true }, function (data) {
                            $('#staticBackdrop2 .modal-body').html(data);
                        }, 'html');
                        $('#staticBackdrop2').find('.modal-footer #AdminApproved').attr('data-id', Id);
                        $('#staticBackdrop2').find('.modal-footer #AdminRefused').attr('data-id', Id);
                        StepDetailModal2.show();
                    }
                }
            });

        });
        $('#datatable').DataTable(
            {
                "language": {
                    "url": "/Scripts/DatatableScripts/tr.json"
                }
            }
        );
        //$('#datatable2').DataTable(
        //    {
        //        "language": {
        //            "url": "/Scripts/DatatableScripts/tr.json"
        //        }
        //    }
        //);
        //#region 'Yönetici Onayı'
        $("body").on("click", "#staticBackdrop2 #AdminApproved", function () {
            var Id = $(this).attr("data-id");
            Swal.fire({
                title: 'Dikkat !',
                text: "Adım durumu 'Yönetici Onayı' olarak değiştirilecektir, emin misiniz?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Vazgeç',
                confirmButtonText: 'Onayla'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        method: "POST",
                        url: '/Project/AdminApproved',
                        data: {
                            Id: Id,
                        },
                        success: function (result) {
                            if (result.IsSuccess) {
                                toastr.success(result.Message);
                                window.table.row(window.removingRow).remove().draw();
                                StepDetailModal2.hide();
                            }
                            else {
                                toastr.warning(result.Message);
                                StepDetailModal2.hide();
                            }
                        },
                        error: function () {
                            alert('Erişim sağlanamadı.');
                        }
                    });
                }
            })
        });
        //#endregion


        //#region Yönetici Reddet
        $("#staticBackdrop2").on("click", "#AdminRefused", function () {
            var Id = $(this).attr("data-id");
            bootbox.prompt({
                title: 'Dikkat ! Reddetmek istediğinize emin misiniz? </br><font style="font-size: 0.9rem;color: #667880;">Lütfen bilgilendirme amaçlı reddetme nedenini yazınız.</font>',
                inputType: 'textarea',
                buttons: {
                    cancel: {
                        label: 'Vazgeç',
                        className: 'btn-danger'
                    },
                    confirm: {
                        label: 'Reddet',
                        className: 'btn-primary'
                    }
                },
                callback: function (result) {
                    if (result !== null && result !== "") {
                        var ReasonForRejection = result; // textarea'da girilen değeri alır
                        $.ajax({
                            method: "POST",
                            url: '/Project/AdminRefused',
                            data: {
                                Id: Id,
                                ReasonForRejection: ReasonForRejection
                            },
                            success: function (result) {
                                if (result.IsSuccess)
                                {
                                    toastr.success(result.Message);
                                    window.table.row(window.removingRow).remove().draw();
                                    StepDetailModal2.hide();
                                } else
                                {
                                    toastr.warning(result.Message);
                                    StepDetailModal2.hide();
                                }
                            },
                            error: function () {
                                alert('Erişim sağlanamadı.');
                            }
                        });
                    }
                    else {
                    alert('Lütfen reddetme nedenini yazınız!');
                    
                    }
                }
            });
        });
        //#endregion
        //#region Yönetici Reddet
        //$("body").on("click", "#staticBackdrop2 #AdminRefused", function () {
        //    var Id = $(this).attr("data-id");
        //    Swal.fire({
        //        title: 'Dikkat !',
        //        text: "Reddetmek istediğinize emin misiniz?",
        //        icon: 'question',
        //        showCancelButton: true,
        //        confirmButtonColor: '#3085d6',
        //        cancelButtonColor: '#d33',
        //        cancelButtonText: 'Vazgeç',
        //        confirmButtonText: 'Reddet',
        //        html: `<p>Lütfen bilgilendirme amaçlı reddetme nedenini yazınız:</p>
        //<textarea id="reasonTextArea" class="col-12 form-control" rows="3"></textarea>`,
        //        onOpen: function () {
        //            setTimeout(() => {
        //                $('#reasonTextArea').focus();
        //            }, 300);
        //        }
        //    }).then((result) => {
        //        if (result.isConfirmed) {
        //            var ReasonForRejection = $('#reasonTextArea').val(); // textarea'da girilen değeri alır
        //            $.ajax({
        //                method: "POST",
        //                url: '/Project/AdminRefused',
        //                data: {
        //                    Id: Id, ReasonForRejection: ReasonForRejection
        //                },
        //                success: function (result) {
        //                    if (result.IsSuccess) {
        //                        toastr.success(result.Message);
        //                        window.table.row(window.removingRow).remove().draw();
        //                        StepDetailModal2.hide();
        //                    }
        //                    else {
        //                        toastr.warning(result.Message);
        //                        StepDetailModal2.hide();
        //                    }
        //                },
        //                error: function () {
        //                    alert('Erişim sağlanamadı.');
        //                }
        //            });
        //        }
        //    })
        //});
//#endregion



        $('body').on('click', '.cardServiceForm', function () {
            var ServiceFormId = $(this).attr("data-id");
            var ProjectId = $(this).attr("data-projectid");
            $.get('GetContentForm', { ProjectId: ProjectId, Crud: "Update", ServiceFormId: ServiceFormId }, function (data) {
                $('#ServiceFormModal .modal-body').html(data);
                // Tüm input, select ve button öğelerini devre dışı bırak
            /*    $('#ServiceFormModal :input:not(.btn-close)').prop('disabled', true);*/
                ServiceFormModal.show();
            }, 'html');
        });

        $('body').on('shown.bs.modal', '#staticBackdrop2', function () {
            $(this).css('overflow-y', 'auto');
        });
        $('body').on('shown.bs.modal', '#ServiceFormModal', function () {
            $(this).css('overflow-y', 'auto');
        });

    });


    //#region Filtreleme İşlemleri
    function FilterTargetList(TableId, filters, numbers) {
        var table = TableId;
        var tr = table.getElementsByTagName("tr");
        // Loop through all table rows, and hide those that don't match the filters
        for (var i = 0; i < tr.length; i++) {
            var match = true;
            for (var j = 0; j < filters.length; j++) {
                var filterValue = filters[j].value;
                if (filterValue !== "All") {
                    var td = tr[i].getElementsByTagName("td")[numbers[j]];
                    if (td) {
                        var txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filterValue.toUpperCase()) === -1) {
                            match = false;
                            break;
                        }
                    }
                }
            }
            if (match) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }

    $(document).ready(function () {
        // Get table element
        var table = document.getElementById("datatable2");
        var filterButton = document.getElementById("FilterButton");
        // Get filter dropdowns
        var ProjectNameFilter = document.getElementById("ProjectName");
        var ApprovalByFilter = document.getElementById("ApprovalBy");
        var ApprovalFilter = document.getElementById("Approval");
        var ApprovalRequestByFilter = document.getElementById("ApprovalRequestBy");
        var numbers = [0, 5, 4, 2];
        // Attach change listeners to filters
        filterButton.addEventListener("click", function () {
            var filters = [ProjectNameFilter, ApprovalByFilter, ApprovalFilter, ApprovalRequestByFilter];
            FilterTargetList(table, filters, numbers);
        });
        // Temizleme butonuna tıklanınca yapılacak işlemler
        $("#ResetTable").click(function () {
            // Tüm filtre inputlarındaki seçimleri sıfırla
            $('.selectpicker').selectpicker('val', '');
            // Tüm satırları tekrar göster
            $("#datatable2 tr").show();
        });
        KTUsersList.init();
    });
    // Kapat butonuna tıklanınca yapılacak işlemler
    $(".sc-closeFilter").click(function () {
        // Tüm filtre inputlarındaki seçimleri sıfırla
        $('.selectpicker').selectpicker('val', '');
        // Tüm satırları tekrar göster
        //$("#datatable2 tr").show();
        const filterForm = document.querySelector('[data-kt-user-table-filter="form"]');
        filterForm.classList.toggle('d-block');
    });

    $('body').on('click', '#FilterForDatatable', function () {
        const filterForm = document.querySelector('[data-kt-user-table-filter="form"]');
        filterForm.classList.toggle('d-block');
    });
    const KTUsersList = (function () {
        const datatable = $('#datatable2').DataTable({
            language: {
                url: '/Scripts/DatatableScripts/tr.json'
            }
        });
    })();
    //#endregion
</script>




