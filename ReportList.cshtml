@model(List<dynamic>,SelectList)
@{
    ViewBag.Title = "ReportList";
    Layout = "~/Views/Shared/NewThema/_LayoutTakvim.cshtml";
}
<link href="~/Content/SweetAlert2/sweetalert2.min.css" rel="stylesheet" />
<link href="~/Content/CustomerPanelCss/custom-modal2.css" rel="stylesheet" />
<style>
    .form-control:disabled, .form-control:read-only {
        background-color: #406C800D;
    }

    .table thead th {
        border-bottom: 1px solid #406C8033 !important;
        background-color: #406C800D;
    }

    .threeDot {
        white-space: nowrap;
        display: inline-block;
        overflow: hidden;
        table-layout: fixed;
        width: 180px;
        text-overflow: ellipsis;
    }

    .rounded-circle {
        box-shadow: none !important;
    }

    .card {
        box-shadow: 0px 0px 20px rgb(31 36 54 / 10%) !important;
    }

    .card-header {
        background-color: #17996E1A !important;
        border-top-right-radius: 6px !important;
        border-top-left-radius: 6px !important;
    }

    .custom-select, .form-control-sm {
        border-radius: 6px !important;
    }

    #showDetails {
        cursor: pointer;
    }

    .close:hover {
        color: #D95757 !important;
        font-size: 20px !important;
    }

    .close {
        font-size: 16px !important;
    }
</style>
<link href="~/Content/DatatableCss/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/ProjectCss/style.css" rel="stylesheet" />

<div class="d-flex flex-column flex-root" id="deneme">
    <div class="page d-flex flex-row flex-column-fluid">
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                <div class="post d-flex flex-column-fluid" id="kt_post">
                    <div id="kt_content_container" class="container-xxl">
                        <div class="container-fluid">
                            <div class="row mt-5">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="table-responsive dash-social">
                                                <table id="datatable" class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Rapor Adı</th>
                                                            <th>Procedure</th>
                                                            <th>Çalıştır/Sil</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.Item1)
                                                         {
                                                            <tr>
                                                                <td class="">
                                                                    <p class="d-inline-block align-middle mb-0">
                                                                        @item.ReportName
                                                                    </p>
                                                                </td>
                                                                <td>@item.ReportProcedure</td>
                                                                <td>
                                                                    <i style="font-size: 1.4rem !important;" class="sc-chart-2 font-16 btn btn-sm btn-soft-info" id="btnExecute_@item.ReportId"></i>
                                                                    @if (item.ReportProcedure != "SP_TAKVIM_RAPOR_BEKLEYEN_ISLER")
                                                                     {
                                                                        if (item.ReportProcedure == "SP_Servis_Form_Report" || item.ReportProcedure == "SP_RAPOR_PERSONEL_PLAN")
                                                                        {
                                                                            <i id="DeleteReport" data-id="@item.ReportId" class="sc-trash-bin font-16 btn btn-sm btn-soft-danger"></i>
                                                                        }
                                                                        else
                                                                        {
                                                                            if (Session["Role"].ToString() == "1")
                                                                            {
                                                                                <i id="DeleteReport" data-id="@item.ReportId" class="sc-trash-bin font-16 btn btn-sm btn-soft-danger"></i>
                                                                            }
                                                                        }
                                                                     }
                                                                    <div id="PopupModal_@item.ReportId" class="custom-modal fade" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                        <div class="modal-dialog" style="margin:10.75rem auto;">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                    <h5 class="modal-title" style="color:#335766;font-weight:bold;" id="exampleModalLabel">Rapor Kriterlerini Giriniz</h5>
                                                                                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                                                                        <i class="sc-close"></i>
                                                                                        <span aria-hidden="true"></span>
                                                                                    </button>
                                                                                </div>
                                                                                <div class="modal-body p-0">
                                                                                    <div class="row m-1">
                                                                                        <div class="align-content-lg-stretch">
                                                                                            <span class="Label-Title" style="margin-left: 0.7rem;">Firma</span>
                                                                                            <select class="selectpicker font13" data-live-search="true" id="companySelect_@item.ReportId">
                                                                                                <option data-tokens="" value="">Seçiniz...</option>
                                                                                                @foreach (var item2 in Model.Item2)
                                                                                                {
                                                                                                    <option value="@item2.Value">@item2.Text</option>
                                                                                                }
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="row m-1">
                                                                                        <div class="col-6">
                                                                                            <span class="Label-Title" style="margin-left: 0.7rem;font-weight:bold;">Başlangıç Tarihi</span>
                                                                                            <div class="input-group" style="margin-top: 0.7rem;">
                                                                                                <input type="date" class="form-control date" name="dates" id="begindate_@item.ReportId">
                                                                                            </div>
                                                                                            <div id="forwardNotification" class="mt-2 Label-Red"></div>
                                                                                        </div>

                                                                                        <div class="col-6">
                                                                                            <span class="Label-Title" style="margin-left: 0.7rem;font-weight:bold;">Bitiş Tarihi</span>
                                                                                            <div class="input-group" style="margin-top: 0.7rem;">
                                                                                                <input type="date" class="form-control date" name="dates" id="enddate_@item.ReportId">
                                                                                            </div>
                                                                                            <div id="forwardNotification" class="mt-2 Label-Red"></div>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                    <button type="button" style="" class="Button-Outline-Close float-end" data-bs-dismiss="modal" id="">Kapat</button>
                                                                                    <button type="button" style="width: 6rem !important;" class="Button-Outline-Kaydet float-end" data-id="@item.ReportProcedure" id="DateSave_@item.ReportId">
                                                                                        Tamam
                                                                                    </button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                         }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/bootstrap.bundle.min.js"></script>
<script src="~/Scripts/SweetAlert2/sweetalert2.all.min.js"></script>
<script src="~/Scripts/DatatableScripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.bootstrap4.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.responsive.min.js"></script>
<script>

    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); // Ocak 0 ile başlar, bu yüzden 1 ekliyoruz
    var yyyy = today.getFullYear();

    var formattedDate = yyyy + '-' + mm + '-' + dd;

    $('.date').val(formattedDate); // Input alanına tarihi yerleştir


    var PopupModal_1 = new bootstrap.Modal(document.getElementById('PopupModal_1'), {
        keyboard: false
    })
    var PopupModal_5 = new bootstrap.Modal(document.getElementById('PopupModal_5'), {
        keyboard: false
    })

    var PopupModal_6 = new bootstrap.Modal(document.getElementById('PopupModal_6'), {
        keyboard: false
    })
    var PopupModal_7 = new bootstrap.Modal(document.getElementById('PopupModal_7'), {
        keyboard: false
    })

    var PopupModal_8 = new bootstrap.Modal(document.getElementById('PopupModal_8'), {
        keyboard: false
    })

    $('#datatable').DataTable(
        {
            "language": {
                "url": "/Scripts/DatatableScripts/tr.json"
            }
        }
    );
    //#region Rapor Sil
    $("body").on("click", "#DeleteReport", function () {
        var ReportId = $(this).attr("data-id");
        var table = $('#datatable').DataTable();
        var removingRow = $(this).closest('tr');
        Swal.fire({
            title: 'Uyarı !',
            text: "Raporu silmek istediğinize emin misiniz?",
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Vazgeç',
            confirmButtonText: 'Raporu  Sil'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    method: "POST",
                    url: '/CpmServisSistemi/DeleteReport',
                    data: {
                        ReportId: ReportId,
                    },
                    success: function (result) {
                        if (result.IsSuccess) {
                            toastr.success(result.Message);
                            table.row(removingRow).remove().draw();
                        }
                        else {
                            toastr.warning(result.Message);
                        }
                    },
                    error: function () {
                        alert('Erişim sağlanamadı.');
                    }
                });
            }
        })

    });
    //#endregion

    //#region  Tarih
    $('body').on('click', '#btnExecute_1', function (event) {

        PopupModal_1.show();
        $('.selectpicker').selectpicker('refresh');
    });

    $('body').on('click', '#btnExecute_5', function (event) {

        PopupModal_5.show();
        $('.selectpicker').selectpicker('refresh');
    });

    $('body').on('click', '#btnExecute_6', function (event) {

        PopupModal_6.show();
        $('.selectpicker').selectpicker('refresh');
    });

    $('body').on('click', '#btnExecute_7', function (event) {

        PopupModal_7.show();
        $('.selectpicker').selectpicker('refresh');
    });

    $('body').on('click', '#btnExecute_8', function (event) {

        PopupModal_8.show();
        $('.selectpicker').selectpicker('refresh');
    });

    $('body').on('click', '#PopupModal_1 #DateSave_1', function (event) {
        debugger;
        var BeginDate = $("#begindate_1").val();
        var EndDate = $("#enddate_1").val();
        var ProcedureName = $("#DateSave_1").attr("data-id");
        var CompanyId = $('#companySelect_1').find('option:selected').val();
        var url = '@Url.Action("ExportServicesToExcelParameters", "CpmServisSistemi")' + '?ProcedureName=' + ProcedureName + '&Page=' + 0 + '&BeginDate=' + BeginDate + '&EndDate=' + EndDate + '&CompanyId=' + CompanyId;
        window.location.href = url;

    });
    //#endregion
    $('body').on('click', '#PopupModal_5 #DateSave_5', function (event) {
    debugger;
        var BeginDate = $("#begindate_5").val();
        var EndDate = $("#enddate_5").val();
        var ProcedureName = $("#DateSave_5").attr("data-id");
        var CompanyId = $('#companySelect_5').find('option:selected').val();
        var url = '@Url.Action("ExportServicesToExcelParameters", "CpmServisSistemi")' + '?ProcedureName=' + ProcedureName + '&Page=' + 0 + '&BeginDate=' + BeginDate + '&EndDate=' + EndDate + '&CompanyId=' + CompanyId;
    window.location.href = url;
    });

    $('body').on('click', '#PopupModal_6 #DateSave_6', function (event) {
    debugger;
        var BeginDate = $("#begindate_6").val();
        var EndDate = $("#enddate_6").val();
        var ProcedureName = $("#DateSave_6").attr("data-id");
        var CompanyId = $('#companySelect_6').find('option:selected').val();
        var url = '@Url.Action("ExportServicesToExcelParameters", "CpmServisSistemi")' + '?ProcedureName=' + ProcedureName + '&Page=' + 0 + '&BeginDate=' + BeginDate + '&EndDate=' + EndDate + '&CompanyId=' + CompanyId;
    window.location.href = url;
    });

    $('body').on('click', '#PopupModal_7 #DateSave_7', function (event) {
    debugger;
        var BeginDate = $("#begindate_7").val();
        var EndDate = $("#enddate_7").val();
        var ProcedureName = $("#DateSave_7").attr("data-id");
        var CompanyId = $('#companySelect_7').find('option:selected').val();
        var url = '@Url.Action("ExportServicesToExcelParameters", "CpmServisSistemi")' + '?ProcedureName=' + ProcedureName + '&Page=' + 0 + '&BeginDate=' + BeginDate + '&EndDate=' + EndDate + '&CompanyId=' + CompanyId;
    window.location.href = url;
    });

    $('body').on('click', '#PopupModal_8 #DateSave_8', function (event) {
    debugger;
        var BeginDate = $("#begindate_8").val();
        var EndDate = $("#enddate_8").val();
        var ProcedureName = $("#DateSave_8").attr("data-id");
        var CompanyId = $('#companySelect_8').find('option:selected').val();
        var url = '@Url.Action("ExportServicesToExcelParameters", "CpmServisSistemi")' + '?ProcedureName=' + ProcedureName + '&Page=' + 0 + '&BeginDate=' + BeginDate + '&EndDate=' + EndDate + '&CompanyId=' + CompanyId;
    window.location.href = url;
    });

</script>