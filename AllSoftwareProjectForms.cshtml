
@{
    ViewBag.Title = "AllSoftwareProjectForms";
    Layout = "~/Views/Shared/NewThema/_LayoutTakvim.cshtml";
}

<link href="~/Content/SweetAlert2/sweetalert2.min.css" rel="stylesheet" />
<link href="~/Content/CustomerPanelCss/custom-modal2.css" rel="stylesheet" />
<style>
    .form-control:disabled, .form-control:read-only {
        background-color: #406C800D;
    }

    .table thead th {
        border-bottom: 1px solid #406C8033 !important;
        background-color: #406C800D;
    }

    .threeDot {
        white-space: nowrap;
        display: inline-block;
        overflow: hidden;
        table-layout: fixed;
        width: 180px;
        text-overflow: ellipsis;
    }

    .rounded-circle {
        box-shadow: none !important;
    }

    .card {
        box-shadow: 0px 0px 20px rgb(31 36 54 / 10%) !important;
    }

    .card-header {
        background-color: #17996E1A !important;
        border-top-right-radius: 6px !important;
        border-top-left-radius: 6px !important;
    }

    .custom-select, .form-control-sm {
        border-radius: 6px !important;
    }
    #showDetails {
        cursor:pointer;
    }
</style>
<link href="~/Content/DatatableCss/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/DatatableCss/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/ProjectCss/style.css" rel="stylesheet" />

<div class="d-flex flex-column flex-root" id="deneme">
    <div class="page d-flex flex-row flex-column-fluid">
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                <div class="post d-flex flex-column-fluid" id="kt_post">
                    <div id="kt_content_container" class="container-xxl">
                        <div class="container-fluid">
                            <div class="row mt-5">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="table-responsive dash-social">
                                                <table id="datatable" class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Firma</th>
                                                            <th>Proje Adı</th>
                                                            <th>Konu</th>
                                                            <th>Proje Sorumlusu</th>
                                                            <th>Adım</th>
                                                            <th>Detay</th>
                                              
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @{string oran = "";}
                                                        @foreach (var item in Model)
                                                        {
                                                            <tr>
                                                                <td class="">
                                                                    <img class=" mr-2" src="~/Images/sidebarimg/icons8-document.png" height="50" />
                                                                    <p class="d-inline-block align-middle mb-0">
                                                                        <a href="" class="d-inline-block align-middle mb-0 product-name threeDot" title="@item.CompanyName"><font style="font-weight:bold;">@item.CompanyName</font></a>
                                                                        <br>
                                                                        <span class="text-muted font-13 threeDot" title="@item.ContractName">@item.ContractName</span>
                                                                    </p>
                                                                </td>
                                                                <td>@item.ProjectName</td>
                                                                <td>
                                                                    <label class="font-weight-bold">@item.Topic</label> <br />
                                                                    <span class="text-muted font-13 threeDot" title="@item.Description">@item.Description</span>

                                                                </td>

                                                                <td>@item.Responsible</td>
                                                                <td>
                                                                    @item.StepName <br />
                                                                    <div class="progress" style="height:7px !important;">
                                                                        @if (item.ProjectStepId == 1)
                                                                        {
                                                                            oran = "15%";
                                                                        }
                                                                        else if (item.ProjectStepId == 2)
                                                                        {
                                                                            oran = "30%";
                                                                        }
                                                                        else if (item.ProjectStepId == 3)
                                                                        {
                                                                            oran = "45%";
                                                                        }
                                                                        else if (item.ProjectStepId == 4)
                                                                        {
                                                                            oran = "60%";
                                                                        }
                                                                        else if (item.ProjectStepId == 5)
                                                                        {
                                                                            oran = "75%";
                                                                        }
                                                                        else if (item.ProjectStepId == 6)
                                                                        {
                                                                            oran = "85%";
                                                                        }
                                                                        else if (item.ProjectStepId == 7)
                                                                        {
                                                                            oran = "100%";
                                                                        }
                                                                        else
                                                                        {
                                                                            oran = "0%";
                                                                        }
                                                                        <div class="progress-bar" role="progressbar" style="background-color: #1ecab8 !important; width:@oran.Replace("'","")" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                                                    </div>
                                                                </td>
                                                                <td>

                                                                    @*<span id="showDetails" data-id="@item.ServiceFormId" class="badge badge-soft-purple">Detay Görüntüle</span>*@
                                                                    <i id="showDetails" data-id="@item.ServiceFormId" class="sc-eye font-16 btn btn-sm btn-soft-purple"></i>

                                                                    <a href="@Url.Action("UpdateSoftwareServiceForm", "CpmServisSistemi", new { ServiceFormId = item.ServiceFormId})" class="mr-2"><i class="sc-edit-pencil font-16 btn btn-sm btn-soft-info"></i></a>
                                                                    <i id="DeleteForm" data-id="@item.ServiceFormId" class="sc-trash-bin font-16 btn btn-sm btn-soft-danger"></i>
                                                                </td>






                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="ModalServiceForm" class="custom-modal fade" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-sm-down" style=" max-width: 55% !important">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="color:#335766;" id="exampleModalLabel">Servis Formu Bilgileri</h5>
                <button type="button" style=" background: none; border: none;" class="sc-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body mx-auto text-center" id="myModalBody" style="margin:0 !important;">

            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/bootstrap.bundle.min.js"></script>
<script src="~/Scripts/SweetAlert2/sweetalert2.all.min.js"></script>
<script src="~/Scripts/DatatableScripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.bootstrap4.min.js"></script>
<script src="~/Scripts/DatatableScripts/dataTables.responsive.min.js"></script>
<script>
    var myModal = new bootstrap.Modal(document.getElementById('ModalServiceForm'), {
        keyboard: false
    })
    $('#datatable').DataTable(
        {
            "language": {
                "url": "/Scripts/DatatableScripts/tr.json"
            }
        }
    );
    //#region Proje Sil
    $("body").on("click", "#DeleteForm", function () {
        var ServiceFormId = $(this).attr("data-id");
        var table = $('#datatable').DataTable();
        var removingRow = $(this).closest('tr');
        Swal.fire({
            title: 'Uyarı !',
            text: "Servis formunu silmek istediğinize emin misiniz?",
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Vazgeç',
            confirmButtonText: 'Servis Formunu Sil'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    method: "POST",
                    url: '/CpmServisSistemi/DeleteSoftwareServiceForm',
                    data: {
                        ServiceFormId: ServiceFormId,
                    },
                    success: function (result) {
                        if (result.IsSuccess) {
                            toastr.success(result.Message);
                            table.row(removingRow).remove().draw();
                        }
                        else {
                            toastr.warning(result.Message);
                        }
                    },
                    error: function () {
                        alert('Erişim sağlanamadı.');
                    }
                });
            }
        })

    });

    // #region Servis Formu
    $("body").on("click", "#showDetails", function ()
    {
        var ServiceFormId = $(this).attr("data-id");
        $.blockUI({
            message: '<lottie-player autoplay  loop mode="normal" src="/Scripts/LottieFiles/cpm-loading-sc.json" style="width: 320px"></lottie-player>',
        });
        $.ajax({
            type: 'POST',
            url: "/CpmServisSistemi/GetSoftwareFormDetails",
            data: { 'ServiceFormId': ServiceFormId },
            success: function (result) {
                myModal.show();
                $("#myModalBody").html(result);
                setTimeout($.unblockUI, 300);
            },
            error: function () {
                alert('Erişim sağlanamadı.');
            }
        });
    });
//#endregion
</script>
